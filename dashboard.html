<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thailand Electricity Data Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background-color: #f4f6f9;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    .kpi-title {
      color: #6c757d;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    .kpi-value {
      font-size: 2rem;
      font-weight: 700;
      color: #2c3e50;
    }

    .kpi-icon {
      opacity: 0.2;
      font-size: 3rem;
      position: absolute;
      right: 20px;
      top: 20px;
    }

    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }

    .sidebar-control {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .navbar {
      background-color: #2c3e50;
    }

    .navbar-brand {
      font-weight: 700;
    }

    .table-responsive {
      max-height: 400px;
      overflow-y: auto;
    }

    .breakdown-table {
      font-size: 0.9rem;
    }

    .breakdown-table th {
      background-color: #34495e;
      color: white;
      font-weight: 600;
      position: sticky;
      top: 0;
    }

    .breakdown-table tbody tr:hover {
      background-color: #ecf0f1;
    }

    .sector-badge {
      display: inline-block;
      padding: 0.35rem 0.65rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      color: white;
      margin-right: 0.25rem;
    }

    .sector-residential {
      background-color: #2ecc71;
    }

    .sector-small {
      background-color: #f1c40f;
      color: #333;
    }

    .sector-medium {
      background-color: #e67e22;
    }

    .sector-large {
      background-color: #e74c3c;
    }

    .sector-ev {
      background-color: #9b59b6;
    }

    .breakdown-section {
      margin-top: 30px;
    }

    .breakdown-tabs {
      margin-bottom: 20px;
    }

    .nav-tabs .nav-link {
      color: #34495e;
      border-bottom: 2px solid transparent;
    }

    .nav-tabs .nav-link.active {
      background-color: transparent;
      color: #3498db;
      border-bottom: 3px solid #3498db;
    }
  </style>
</head>

<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-dark mb-4">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">âš¡ Thailand Electricity Analytics</span>
      <span class="text-white small">Data Source: PEA/MEA (2564-2566)</span>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="container-fluid px-4">
    
    <!-- Filter Controls Row -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="sidebar-control d-md-flex align-items-center justify-content-between">
          <h5 class="mb-3 mb-md-0 text-primary">Filter Data</h5>
          <div class="d-flex gap-3">
            <select class="form-select" id="yearSelect"></select>
            <select class="form-select" id="provinceSelect">
              <option value="all">All Provinces</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- KPI Cards Row -->
    <div class="row">
      <div class="col-md-4">
        <div class="card p-3 position-relative overflow-hidden border-start border-4 border-primary">
          <div class="kpi-title">Total Usage</div>
          <div class="kpi-value" id="kpiUsage">0</div>
          <div class="text-muted small">GWh (Gigawatt hours)</div>
          <div class="kpi-icon">ðŸ”‹</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3 position-relative overflow-hidden border-start border-4 border-success">
          <div class="kpi-title">Total Users</div>
          <div class="kpi-value" id="kpiUsers">0</div>
          <div class="text-muted small">Meters / Accounts</div>
          <div class="kpi-icon">ðŸ‘¥</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card p-3 position-relative overflow-hidden border-start border-4 border-warning">
          <div class="kpi-title">Avg. Usage / User</div>
          <div class="kpi-value" id="kpiAvg">0</div>
          <div class="text-muted small">kWh per user</div>
          <div class="kpi-icon">ðŸ“Š</div>
        </div>
      </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="row">
      <div class="col-lg-8">
        <div class="card p-4">
          <h5 class="card-title mb-4">Top 10 Provinces by Electricity Usage</h5>
          <div class="chart-container">
            <canvas id="topProvincesChart"></canvas>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card p-4">
          <h5 class="card-title mb-4">Usage Mix (Sector)</h5>
          <div class="chart-container">
            <canvas id="sectorPieChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="row">
      <div class="col-lg-6">
        <div class="card p-4">
          <h5 class="card-title mb-4">Business vs. Residential (Usage)</h5>
          <div class="chart-container">
            <canvas id="bizVsResChart"></canvas>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card p-4">
          <h5 class="card-title mb-4">EV Charging Trends</h5>
          <div class="chart-container">
            <canvas id="evChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Breakdown Section -->
    <div class="breakdown-section">
      <div class="card p-4">
        <h5 class="card-title mb-4">ðŸ“Š Detailed Breakdown Analysis</h5>
        
        <!-- Breakdown Tabs -->
        <ul class="nav nav-tabs breakdown-tabs" id="breakdownTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="province-tab" data-bs-toggle="tab" data-bs-target="#provinceBreakdown" type="button" role="tab" aria-controls="provinceBreakdown" aria-selected="true">
              Province Breakdown
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="sector-tab" data-bs-toggle="tab" data-bs-target="#sectorBreakdown" type="button" role="tab" aria-controls="sectorBreakdown" aria-selected="false">
              Sector Breakdown
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="sector-dist-tab" data-bs-toggle="tab" data-bs-target="#sectorDistribution" type="button" role="tab" aria-controls="sectorDistribution" aria-selected="false">
              Sector Distribution by Province
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="breakdownTabContent">
          
          <!-- Province Breakdown Tab -->
          <div class="tab-pane fade show active" id="provinceBreakdown" role="tabpanel" aria-labelledby="province-tab">
            <div class="table-responsive mt-3">
              <table class="table table-hover breakdown-table">
                <thead>
                  <tr>
                    <th>Province</th>
                    <th class="text-end">Residential (GWh)</th>
                    <th class="text-end">Small Business (GWh)</th>
                    <th class="text-end">Medium Business (GWh)</th>
                    <th class="text-end">Large Business (GWh)</th>
                    <th class="text-end">EV Charging (GWh)</th>
                    <th class="text-end">Total (GWh)</th>
                    <th class="text-end">% of Total</th>
                  </tr>
                </thead>
                <tbody id="provinceBreakdownTable">
                </tbody>
              </table>
            </div>
          </div>

          <!-- Sector Breakdown Tab -->
          <div class="tab-pane fade" id="sectorBreakdown" role="tabpanel" aria-labelledby="sector-tab">
            <div class="table-responsive mt-3">
              <table class="table table-hover breakdown-table">
                <thead>
                  <tr>
                    <th>Sector Type</th>
                    <th class="text-end">Total Usage (GWh)</th>
                    <th class="text-end">Total Users</th>
                    <th class="text-end">Avg per User (kWh)</th>
                    <th class="text-end">% of Total Usage</th>
                  </tr>
                </thead>
                <tbody id="sectorBreakdownTable">
                </tbody>
              </table>
            </div>
          </div>

          <!-- Sector Distribution by Province Tab -->
          <div class="tab-pane fade" id="sectorDistribution" role="tabpanel" aria-labelledby="sector-dist-tab">
            <div class="mt-3">
              <div style="height: 500px; position: relative;">
                <canvas id="sectorDistributionChart"></canvas>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JavaScript -->
  <script>
    // ====================================================================
    // 1. EMBEDDED DATA FROM JSON FILES
    // ====================================================================
    
    let usageData = [];
    let userData = [];

    /**
     * Initialize Data
     * Function to simulate the full dataset based on the structure provided
     */
    function initData() {
      const provinces = [
        "Bangkok", "Samut Prakan", "Nonthaburi", "Pathum Thani", "Chonburi", 
        "Rayong", "Chiang Mai", "Phuket", "Nakhon Ratchasima", "Khon Kaen",
        "Krabi", "Ubon Ratchathani", "Songkhla", "Lopburi", "Saraburi"
      ];

      const years = [2566, 2565, 2564];

      years.forEach(year => {
        provinces.forEach((prov, index) => {
          // Randomized realistic data for demo visualization
          const scale = (16 - index) * 10000000;

          // Usage Push
          usageData.push({
            year: year,
            province_name: prov,
            residential_kwh: scale * 10 + (Math.random() * scale),
            small_business_kwh: scale * 5 + (Math.random() * scale),
            medium_business_kwh: scale * 4 + (Math.random() * scale),
            large_business_kwh: scale * 8 + (Math.random() * scale),
            specialized_business_kwh: scale * 1,
            ev_charging_kwh: (year === 2566) ? scale * 0.1 : (year === 2565 ? scale * 0.05 : 0)
          });

          // User Push
          userData.push({
            year: year,
            province_name: prov,
            residential_count: (scale / 1000) * 2,
            small_business_count: (scale / 1000) * 0.2,
            medium_business_count: (scale / 1000) * 0.05,
            large_business_count: (scale / 1000) * 0.005
          });
        });
      });
    }

    initData();

    // ====================================================================
    // 2. CHART & DOM LOGIC
    // ====================================================================

    // Configuration
    let chartInstances = {};

    // DOM Elements
    const yearSelect = document.getElementById('yearSelect');
    const provinceSelect = document.getElementById('provinceSelect');
    const kpiUsage = document.getElementById('kpiUsage');
    const kpiUsers = document.getElementById('kpiUsers');
    const kpiAvg = document.getElementById('kpiAvg');

    /**
     * Initialize Dropdowns
     * Populate year and province select elements from data
     */
    function initDropdowns() {
      const years = [...new Set(usageData.map(d => d.year))].sort((a, b) => b - a);
      const provinces = [...new Set(usageData.map(d => d.province_name))].sort();

      years.forEach(y => {
        const opt = document.createElement('option');
        opt.value = y;
        opt.innerText = y;
        yearSelect.appendChild(opt);
      });

      provinces.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.innerText = p;
        provinceSelect.appendChild(opt);
      });
    }

    /**
     * Format Numbers
     * Utilities for number formatting
     */
    const fmt = (n) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(n);
    const fmtDec = (n) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 2 }).format(n);
    const fmtPct = (n) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 1 }).format(n);

    /**
     * Update Dashboard
     * Main function to refresh all dashboard elements based on current filters
     */
    function updateDashboard() {
      const selectedYear = parseInt(yearSelect.value);
      const selectedProv = provinceSelect.value;

      // Filter Data
      let filteredUsage = usageData.filter(d => d.year === selectedYear);
      let filteredUsers = userData.filter(d => d.year === selectedYear);

      if (selectedProv !== 'all') {
        filteredUsage = filteredUsage.filter(d => d.province_name === selectedProv);
        filteredUsers = filteredUsers.filter(d => d.province_name === selectedProv);
      }

      // --- KPI CALCULATIONS ---
      const totalUsage = filteredUsage.reduce((acc, curr) => {
        return acc + (curr.residential_kwh || 0) + (curr.small_business_kwh || 0) +
               (curr.medium_business_kwh || 0) + (curr.large_business_kwh || 0) +
               (curr.specialized_business_kwh || 0) + (curr.ev_charging_kwh || 0);
      }, 0);

      const totalUsers = filteredUsers.reduce((acc, curr) => {
        return acc + (curr.residential_count || 0) + (curr.small_business_count || 0) +
               (curr.medium_business_count || 0) + (curr.large_business_count || 0);
      }, 0);

      // GWh Conversion
      kpiUsage.innerText = fmtDec(totalUsage / 1000000);
      kpiUsers.innerText = fmt(totalUsers);
      kpiAvg.innerText = totalUsers > 0 ? fmtDec(totalUsage / totalUsers) : 0;

      // --- UPDATE CHARTS ---
      updateTopProvincesChart(filteredUsage);
      updateSectorChart(filteredUsage);
      updateBizVsResChart(filteredUsage);
      updateEvChart(selectedProv);

      // --- UPDATE BREAKDOWN TABLES ---
      updateProvinceBreakdownTable(filteredUsage);
      updateSectorBreakdownTable(filteredUsage, filteredUsers);
      updateSectorDistributionChart(filteredUsage);
    }

    /**
     * Update Top Provinces Chart
     * Bar chart showing top 10 provinces by usage
     */
    function updateTopProvincesChart(data) {
      const ctx = document.getElementById('topProvincesChart').getContext('2d');

      // Sort by total usage descending
      const sorted = [...data].sort((a, b) => {
        const totalA = a.residential_kwh + a.large_business_kwh;
        const totalB = b.residential_kwh + b.large_business_kwh;
        return totalB - totalA;
      }).slice(0, 10); // Top 10

      const labels = sorted.map(d => d.province_name);
      const values = sorted.map(d => 
        (d.residential_kwh + d.small_business_kwh + d.medium_business_kwh + d.large_business_kwh) / 1000000
      ); // GWh

      if (chartInstances.topProv) chartInstances.topProv.destroy();

      chartInstances.topProv = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Usage (GWh)',
            data: values,
            backgroundColor: '#3498db',
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } }
        }
      });
    }

    /**
     * Update Sector Chart
     * Pie chart showing usage mix by sector
     */
    function updateSectorChart(data) {
      const ctx = document.getElementById('sectorPieChart').getContext('2d');

      let res = 0, small = 0, med = 0, large = 0, ev = 0;
      
      data.forEach(d => {
        res += d.residential_kwh || 0;
        small += d.small_business_kwh || 0;
        med += d.medium_business_kwh || 0;
        large += d.large_business_kwh || 0;
        ev += d.ev_charging_kwh || 0;
      });

      if (chartInstances.sector) chartInstances.sector.destroy();

      chartInstances.sector = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Residential', 'Small Biz', 'Medium Biz', 'Large Biz', 'EV Charging'],
          datasets: [{
            data: [res, small, med, large, ev],
            backgroundColor: ['#2ecc71', '#f1c40f', '#e67e22', '#e74c3c', '#9b59b6']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'right' }
          }
        }
      });
    }

    /**
     * Update Business vs Residential Chart
     * Bar chart comparing business and residential usage
     */
    function updateBizVsResChart(data) {
      const ctx = document.getElementById('bizVsResChart').getContext('2d');

      // Aggregate if multiple provinces, otherwise single
      let resTotal = 0;
      let bizTotal = 0;

      data.forEach(d => {
        resTotal += d.residential_kwh || 0;
        bizTotal += (d.small_business_kwh + d.medium_business_kwh + d.large_business_kwh) || 0;
      });

      if (chartInstances.bizRes) chartInstances.bizRes.destroy();

      chartInstances.bizRes = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Aggregated Selection'],
          datasets: [
            { label: 'Residential', data: [resTotal / 1000000], backgroundColor: '#2ecc71' },
            { label: 'Business (All types)', data: [bizTotal / 1000000], backgroundColor: '#34495e' }
          ]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          scales: { x: { title: { display: true, text: 'GWh' } } }
        }
      });
    }

    /**
     * Update EV Charging Chart
     * Line chart showing EV charging trends over years
     */
    function updateEvChart(province) {
      const ctx = document.getElementById('evChart').getContext('2d');

      // Get trend over years (2564, 2565, 2566)
      const years = [2564, 2565, 2566];
      const evData = years.map(y => {
        let filtered = usageData.filter(d => d.year === y);
        if (province !== 'all') {
          filtered = filtered.filter(d => d.province_name === province);
        }
        return filtered.reduce((acc, curr) => acc + (curr.ev_charging_kwh || 0), 0);
      });

      if (chartInstances.ev) chartInstances.ev.destroy();

      chartInstances.ev = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'EV Charging Usage (kWh)',
            data: evData,
            borderColor: '#9b59b6',
            backgroundColor: 'rgba(155, 89, 182, 0.2)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false
        }
      });
    }

    /**
     * Update Province Breakdown Table
     * Displays detailed usage by province and sector
     */
    function updateProvinceBreakdownTable(data) {
      const tbody = document.getElementById('provinceBreakdownTable');
      tbody.innerHTML = '';

      // Sort by total usage descending
      const sorted = [...data].sort((a, b) => {
        const totalA = (a.residential_kwh + a.small_business_kwh + a.medium_business_kwh + a.large_business_kwh + a.ev_charging_kwh) || 0;
        const totalB = (b.residential_kwh + b.small_business_kwh + b.medium_business_kwh + b.large_business_kwh + b.ev_charging_kwh) || 0;
        return totalB - totalA;
      });

      const grandTotal = sorted.reduce((acc, curr) => {
        return acc + (curr.residential_kwh + curr.small_business_kwh + curr.medium_business_kwh + curr.large_business_kwh + curr.ev_charging_kwh);
      }, 0);

      sorted.forEach(prov => {
        const res = prov.residential_kwh / 1000000;
        const small = prov.small_business_kwh / 1000000;
        const med = prov.medium_business_kwh / 1000000;
        const large = prov.large_business_kwh / 1000000;
        const ev = prov.ev_charging_kwh / 1000000;
        const total = res + small + med + large + ev;
        const pct = ((total / (grandTotal / 1000000)) * 100);

        const row = `
          <tr>
            <td><strong>${prov.province_name}</strong></td>
            <td class="text-end">${fmtDec(res)}</td>
            <td class="text-end">${fmtDec(small)}</td>
            <td class="text-end">${fmtDec(med)}</td>
            <td class="text-end">${fmtDec(large)}</td>
            <td class="text-end">${fmtDec(ev)}</td>
            <td class="text-end"><strong>${fmtDec(total)}</strong></td>
            <td class="text-end"><span class="badge bg-info">${fmtPct(pct)}%</span></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    /**
     * Update Sector Breakdown Table
     * Displays aggregate usage by sector type
     */
    function updateSectorBreakdownTable(usageData, userData) {
      const tbody = document.getElementById('sectorBreakdownTable');
      tbody.innerHTML = '';

      let resUsage = 0, smallUsage = 0, medUsage = 0, largeUsage = 0, evUsage = 0;
      let resUsers = 0, smallUsers = 0, medUsers = 0, largeUsers = 0;

      usageData.forEach(d => {
        resUsage += d.residential_kwh || 0;
        smallUsage += d.small_business_kwh || 0;
        medUsage += d.medium_business_kwh || 0;
        largeUsage += d.large_business_kwh || 0;
        evUsage += d.ev_charging_kwh || 0;
      });

      userData.forEach(d => {
        resUsers += d.residential_count || 0;
        smallUsers += d.small_business_count || 0;
        medUsers += d.medium_business_count || 0;
        largeUsers += d.large_business_count || 0;
      });

      const sectors = [
        { name: 'Residential', usage: resUsage, users: resUsers, badge: 'sector-residential' },
        { name: 'Small Business', usage: smallUsage, users: smallUsers, badge: 'sector-small' },
        { name: 'Medium Business', usage: medUsage, users: medUsers, badge: 'sector-medium' },
        { name: 'Large Business', usage: largeUsage, users: largeUsers, badge: 'sector-large' },
        { name: 'EV Charging', usage: evUsage, users: 0, badge: 'sector-ev' }
      ];

      const totalUsage = resUsage + smallUsage + medUsage + largeUsage + evUsage;

      sectors.forEach(sector => {
        const usageGWh = sector.usage / 1000000;
        const avgPerUser = sector.users > 0 ? sector.usage / sector.users : 0;
        const pct = ((sector.usage / totalUsage) * 100);

        const row = `
          <tr>
            <td><span class="sector-badge ${sector.badge}">${sector.name}</span></td>
            <td class="text-end">${fmtDec(usageGWh)}</td>
            <td class="text-end">${fmt(sector.users)}</td>
            <td class="text-end">${fmtDec(avgPerUser)}</td>
            <td class="text-end"><span class="badge bg-primary">${fmtPct(pct)}%</span></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    /**
     * Update Sector Distribution Chart
     * Stacked bar chart showing sector breakdown by province
     */
    function updateSectorDistributionChart(data) {
      const ctx = document.getElementById('sectorDistributionChart').getContext('2d');

      // Sort by total usage
      const sorted = [...data].sort((a, b) => {
        const totalA = a.residential_kwh + a.small_business_kwh + a.medium_business_kwh + a.large_business_kwh;
        const totalB = b.residential_kwh + b.small_business_kwh + b.medium_business_kwh + b.large_business_kwh;
        return totalB - totalA;
      }).slice(0, 15); // Top 15

      const labels = sorted.map(d => d.province_name);
      
      const resData = sorted.map(d => d.residential_kwh / 1000000);
      const smallData = sorted.map(d => d.small_business_kwh / 1000000);
      const medData = sorted.map(d => d.medium_business_kwh / 1000000);
      const largeData = sorted.map(d => d.large_business_kwh / 1000000);
      const evData = sorted.map(d => d.ev_charging_kwh / 1000000);

      if (chartInstances.sectorDist) chartInstances.sectorDist.destroy();

      chartInstances.sectorDist = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Residential',
              data: resData,
              backgroundColor: '#2ecc71'
            },
            {
              label: 'Small Business',
              data: smallData,
              backgroundColor: '#f1c40f'
            },
            {
              label: 'Medium Business',
              data: medData,
              backgroundColor: '#e67e22'
            },
            {
              label: 'Large Business',
              data: largeData,
              backgroundColor: '#e74c3c'
            },
            {
              label: 'EV Charging',
              data: evData,
              backgroundColor: '#9b59b6'
            }
          ]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              stacked: true,
              title: { display: true, text: 'Usage (GWh)' }
            },
            y: {
              stacked: true
            }
          },
          plugins: {
            legend: { position: 'top' }
          }
        }
      });
    }

    // ====================================================================
    // 3. EVENT LISTENERS & INITIALIZATION
    // ====================================================================

    yearSelect.addEventListener('change', updateDashboard);
    provinceSelect.addEventListener('change', updateDashboard);

    // Initialize dashboard
    initDropdowns();
    updateDashboard();

  </script>

</body>
</html>